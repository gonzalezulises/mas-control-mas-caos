digraph DegeneracionGate {
    graph [
        bgcolor="transparent"
        fontname="Helvetica Neue"
        fontcolor="#ffffff"
        rankdir=TB
        splines=polyline
        nodesep=0.5
        ranksep=1.0
        pad=0.3
    ];
    node [fontname="Helvetica Neue" fontsize=10 fontcolor="#ffffff"];
    edge [fontname="Helvetica Neue" fontsize=9 fontcolor="#8899aa"];

    // === ESTADO INICIAL ===
    funcional [
        label="GATE FUNCIONAL\n━━━━━━━━━━━━━━\nCriterios explícitos\nOperadores protegidos\nVeredictos vinculantes"
        shape=box
        style="filled,bold,rounded"
        fillcolor="#1e3a5f"
        color="#3d7ab7"
        fontcolor="#ffffff"
        penwidth=3
    ]

    // === PRESIONES EXTERNAS ===
    presiones [
        label="PRESIONES"
        shape=none
        fontcolor="#dc143c"
        fontsize=11
    ]

    presion [
        label="Velocidad"
        shape=circle
        style=filled
        fillcolor="#8b0000"
        color="#dc143c"
        fontcolor="#ffffff"
        width=0.9
    ]

    urgencia [
        label="Urgencia\npolítica"
        shape=circle
        style=filled
        fillcolor="#8b0000"
        color="#dc143c"
        fontcolor="#ffffff"
        width=0.9
    ]

    // === FASE 1: EXCEPCIONES ===
    excepciones [
        label="EXCEPCIONES\nACUMULADAS"
        shape=box
        style="filled,bold"
        fillcolor="#8b0000"
        color="#dc143c"
        fontcolor="#ffffff"
        penwidth=3
    ]

    loopR1 [
        label=<R1<BR/><FONT POINT-SIZE="7">(+)</FONT>>
        shape=circle
        style=filled
        fillcolor="#dc143c"
        color="#8b0000"
        fontcolor="#ffffff"
        width=0.4
        fontsize=10
    ]

    // === FASE 2: EROSIÓN ===
    erosion [
        label="EROSIÓN DE\nCRITERIOS"
        shape=box
        style="filled,bold"
        fillcolor="#5c0000"
        color="#dc143c"
        fontcolor="#ffffff"
        penwidth=3
    ]

    // === FASE 3: PÉRDIDA AUTORIDAD ===
    autoridad [
        label="PÉRDIDA DE\nAUTORIDAD"
        shape=box
        style="filled,bold"
        fillcolor="#5c0000"
        color="#dc143c"
        fontcolor="#ffffff"
        penwidth=3
    ]

    loopR2 [
        label=<R2<BR/><FONT POINT-SIZE="7">(+)</FONT>>
        shape=circle
        style=filled
        fillcolor="#dc143c"
        color="#8b0000"
        fontcolor="#ffffff"
        width=0.4
        fontsize=10
    ]

    // === FASE 4: TEATRO ===
    teatro [
        label="TEATRO\nORGANIZACIONAL"
        shape=box
        style="filled,bold"
        fillcolor="#3d0000"
        color="#dc143c"
        fontcolor="#ffffff"
        penwidth=3
    ]

    // === ESTADO FINAL ===
    disfuncional [
        label="GATE DISFUNCIONAL\n━━━━━━━━━━━━━━━\nSin poder real\nAprobación automática\nResponsabilidad difusa"
        shape=box
        style="filled,bold,rounded"
        fillcolor="#3d0000"
        color="#dc143c"
        fontcolor="#ffffff"
        penwidth=3
    ]

    // === LEYENDA ===
    leyenda [
        label=<
        <TABLE BORDER="1" CELLBORDER="0" CELLSPACING="3" CELLPADDING="5" COLOR="#2d5a87">
            <TR><TD COLSPAN="2" ALIGN="CENTER"><B><FONT POINT-SIZE="9" COLOR="#000000">LEYENDA</FONT></B></TD></TR>
            <TR>
                <TD BGCOLOR="#1e3a5f"><FONT POINT-SIZE="7" COLOR="#ffffff">▭</FONT></TD>
                <TD ALIGN="LEFT"><FONT POINT-SIZE="7" COLOR="#000000">Stock</FONT></TD>
            </TR>
            <TR>
                <TD><FONT POINT-SIZE="9" COLOR="#dc143c">○</FONT></TD>
                <TD ALIGN="LEFT"><FONT POINT-SIZE="7" COLOR="#000000">Presión</FONT></TD>
            </TR>
            <TR>
                <TD BGCOLOR="#dc143c"><FONT POINT-SIZE="7" COLOR="#ffffff">R+</FONT></TD>
                <TD ALIGN="LEFT"><FONT POINT-SIZE="7" COLOR="#000000">Loop degenerativo</FONT></TD>
            </TR>
        </TABLE>
        >
        shape=none
    ]

    // === FLUJO PRINCIPAL (VERTICAL) ===
    funcional -> excepciones [label="  presión\n  genera" color="#dc143c" fontcolor="#dc143c"]
    excepciones -> erosion [label="  fuerza\n  flexibilidad" color="#dc143c" fontcolor="#dc143c"]
    erosion -> autoridad [label="  debilita" color="#dc143c" fontcolor="#dc143c"]
    autoridad -> teatro [label="  colapsa en" color="#dc143c" fontcolor="#dc143c"]
    teatro -> disfuncional [label="  produce" color="#dc143c" fontcolor="#dc143c"]

    // === PRESIONES HACIA EXCEPCIONES ===
    presion -> excepciones [color="#dc143c" style=dashed]
    urgencia -> excepciones [color="#dc143c" style=dashed]

    // === LOOPS DEGENERATIVOS ===
    teatro -> excepciones [label="normaliza  " color="#dc143c" fontcolor="#dc143c" style=dashed constraint=false]

    // === LAYOUT VERTICAL ===
    {rank=same; funcional; leyenda}
    {rank=same; presiones; presion; urgencia}
    {rank=same; excepciones; loopR1}
    {rank=same; autoridad; loopR2}
}
