name: Validar Libro (Solo Reporte)

# Este workflow SOLO DETECTA Y REPORTA errores.
# NO modifica archivos ni aplica correcciones automÃ¡ticas.
# Las correcciones deben hacerse manualmente con: ./scripts/fix_orthography.sh

on:
  push:
    branches: [main]
    paths:
      - 'chapters/**'
      - 'tests/**'
  pull_request:
    branches: [main]
    paths:
      - 'chapters/**'
      - 'tests/**'

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Validar ortografÃ­a (solo reporte)
        id: ortografia
        run: |
          echo "## ValidaciÃ³n OrtogrÃ¡fica" >> $GITHUB_STEP_SUMMARY
          if python3 tests/test_orthography.py 2>&1 | tee ortografia.log; then
            echo "âœ… Sin errores ortogrÃ¡ficos" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Se encontraron errores ortogrÃ¡ficos (ver log)" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            cat ortografia.log >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

      - name: Validar estructura de capÃ­tulos (solo reporte)
        id: estructura
        run: |
          echo "## ValidaciÃ³n de Estructura" >> $GITHUB_STEP_SUMMARY
          if python3 tests/test_chapter_structure_blocks.py chapters/ 2>&1 | tee estructura.log; then
            echo "âœ… Estructura correcta" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Se encontraron problemas de estructura" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            head -50 estructura.log >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

      - name: Validar lenguaje prohibido (solo reporte)
        id: lenguaje
        run: |
          echo "## ValidaciÃ³n de Lenguaje" >> $GITHUB_STEP_SUMMARY
          if python3 tests/test_forbidden_language.py chapters/ 2>&1 | tee lenguaje.log; then
            echo "âœ… Sin lenguaje prohibido" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Se encontrÃ³ lenguaje prohibido" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            head -50 lenguaje.log >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

      - name: Resumen final
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ **Nota**: Este workflow solo reporta. Para corregir:" >> $GITHUB_STEP_SUMMARY
          echo '```bash' >> $GITHUB_STEP_SUMMARY
          echo "./scripts/fix_orthography.sh  # CorrecciÃ³n ortogrÃ¡fica" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
